#!/usr/bin/python
#GPLv2

import sys
import os
from OpenGL.GL import *
from PyQt5 import QtGui, uic, QtCore, QtWidgets
from PyQt5.QtOpenGL import *
from viewerwidget import *

class MainW(QtWidgets.QMainWindow):
  def __init__(self):
    QtWidgets.QMainWindow.__init__(self)
    uic.loadUi('viewer.ui', self)
    self.gl.loadGCode(sys.argv[1])

    self.fileWatcher = QtCore.QFileSystemWatcher()
    self.fileWatcher.fileChanged.connect(self.on_file_changed)
    self.fileWatcher.addPath(sys.argv[1])

  def on_file_changed(self, name):
    print 'reload'
    self.gl.loadGCode(name)


def main():
  app = QtWidgets.QApplication(['Viewer'])
  m = MainW()
  m.show()

  sys.exit(app.exec_())
  pass

if __name__ == '__main__':
  main()
